<!DOCTYPE html>
<html lang="ko">
<head>
  <!--
    [ë¬¸ì„œ ê¸°ë³¸ ì„¤ì •]
    - lang="ko" : ì´ë¬¸ì„œ(í˜ì´ì§€)ëŠ” í•œêµ­ì–´ë¡œ ì‘ì„±ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸
    - <meta charset="UTF-8"> : ê¸€ìê°€ ê¹¨ì§€ì§€ ì•Šê²Œ UTF-8 ì¸ì½”ë”© ì‚¬ìš©
    - <meta name="viewport"...> : ëª¨ë°”ì¼ í™”ë©´ì—ì„œ ê¸€ì”¨ê°€ ë„ˆë¬´ ì‘ê±°ë‚˜ ê¹¨ì§€ì§€ ì•Šê²Œ í™”ë©´ ë¹„ìœ¨ ë§ì¶”ê¸°
  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>ë­í‚¹ (Top 50)</title>

  <!--
    [CSS: í™”ë©´ì„ ê¾¸ë¯¸ëŠ” ìŠ¤íƒ€ì¼]
    - ì•„ë˜ ìŠ¤íƒ€ì¼ì€ "ë³´ê¸° ì¢‹ê²Œ" ë§Œë“¤ê¸° ìœ„í•œ ë””ìì¸ ì½”ë“œ
    - ì½”ë“œ ì• ì£¼ì„ì„ ì½ìœ¼ë©° "ë¬´ì—‡ì„" "ì™œ" í•˜ëŠ”ì§€ ì´í•´í•´ë³´ì
  -->
  <style>
    /* ==========================
       ì „ì²´ í˜ì´ì§€ì— ì“°ì¼ ê³µí†µ ì„¤ì •
       ========================== */
    
       /* :root : ì „ì—­(ì „ì²´)ì—ì„œ ì¬ì‚¬ìš©í•  ê°’ì„ ì €ì¥í•˜ëŠ” ê³³ (CSS ë³€ìˆ˜) */
       :root {
        --max-w: 600px; /* PCì—ì„œ ë³¸ë¬¸(ì½˜í…ì¸ ) ìµœëŒ€ ê°€ë¡œ í­ì„ 600pxë¡œ ì œí•œ */
       }

       /* body : í˜ì´ì§€ ì „ì²´ì˜ ê¸°ë³¸ ê¸€ê¼´, ë°°ê²½, ê¸€ììƒ‰ ë“± */
       body {
        margin: 0; /* ë¸Œë¼ìš°ì € ê¸°ë³¸ ì—¬ë°± ì œê±° -> í™”ë©´ì„ ê½‰ ì±„ì›€ */
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; /* ì½ê¸° ì¢‹ì€ ê¸°ë³¸ ê¸€ê¼´ë“¤ */
        background: #f6f7fb; /* ì˜…ì€ íšŒìƒ‰ ë°°ê²½ -> ëˆˆì— í¸ì•ˆ */
        color: #222; /* ê¸€ììƒ‰: ì§„í•œ íšŒìƒ‰(ì™„ì „ ê²€ì •ë³´ë‹¤ ë¶€ë“œëŸ½ë‹¤) */
       }

       /* .wrap : í™”ë©´ì˜ ë‚´ìš©ì„ ê°ì‹¸ëŠ” ë°”ê¹¥ ì»¨í…Œì´ë„ˆ(ì—¬ë°±/ê°€ìš´ë° ì •ë ¬) */
       .wrap {
        margin: 0 auto;                  /* ì¢Œìš° ìë™ ì—¬ë°± -> ê°€ìš´ë° ì •ë ¬ íš¨ê³¼ */
        padding: 24px 16px 48px;         /* ìœ„/ì–‘ì˜†/ì•„ë˜ ì—¬ë°± */
        /* í˜¹ì€ ì•„ë˜ ë¯¸ë””ì–´ì¿¼ë¦¬ì—ì„œ PC/ëª¨ë°”ì¼ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì¤Œ */
       }

       /* =========================
          ìƒë‹¨ ì œëª©/ì„¤ëª… ì…ë ¥
          ========================= */
      .header {
        max-width: var(--max-w); /* PCì—ì„œ 600px ë„ˆë¹„ ì œí•œ */
        margin: 0 auto 16px;     /* ê°€ìš´ë° ì •ë ¬ + ì•„ë˜ë¡œ 16px ì—¬ë°± */
        display: flex;           /* ê°€ë¡œ ë°°ì¹˜ */
        align-items: center;     /* ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬ */
        gap: 12px;               /* ì•„ì´í…œ ì‚¬ì´ ê°„ê²© */
      }    

      .title {
        font-weight: 800;              /* ì•„ì£¼ êµµê²Œ */
        font-size: 20px;               /* í¬ê²Œ */
        letter-spacing: 0.3px;         /* ê¸€ì ì‚¬ì´ ì•½ê°„ ë²Œë¦¬ê¸° -> ì œëª© ëŠë‚Œ */
      }

      .sub {
        color: #666;             /* ì—°í•œ íšŒìƒ‰ -> ë³´ì¡° ì„¤ëª… ëŠë‚Œ */
        font-size: 12px;           /* ì‘ê²Œ */
      }

      /* ==========================
         ì¹´ë“œ(ë°•ìŠ¤) í˜•íƒœ ë ˆì´ì•„ì›ƒ
         ========================== */

      .card {
        max-width: var(--max-w);   /* PC ìµœëŒ€ ê°€ë¡œ 600px */
        margin: 0 auto;            /* ê°€ìš´ë° ì •ë ¬ */
        background: #fff;        /* í°ìƒ‰ ë°°ê²½ */
        border-radius: 14px;       /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
        box-shadow: 0 6px 20px rgba(0,0,0,0.08); /* ê·¸ë¦¼ì -> ì¹´ë“œì²˜ëŸ¼ ë³´ì„ */
        overflow: hidden;          /* ì•ˆìª½ ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ê°€ë¦¼ */
      }

      /* ì¹´ë“œ ìƒë‹¨ì˜ ë²„íŠ¼ ì˜ì—­(íˆ´ë°”) */
      .toolbar {
        display: flex;                    /* ê°€ë¡œ ë°°ì¹˜ */
        align-items: center;              /* ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬ */
        justify-content: space-between;   /* ì¢Œìš° ëìœ¼ë¡œ ë²Œë¦¬ê¸° */
        gap: 8px;                         /* ìš”ì†Œ ì‚¬ì´ ê°„ê²© */
        padding: 12px 14px;               /* ì•ˆìª½ ì—¬ë°± */
        border-bottom: 1px solid #eee;    /* ì•„ë˜ìª½ ì„ ìœ¼ë¡œ êµ¬ë¶„ */
        background: #fafafa;              /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
      }

      /* ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
      .btn {
        appearance: none;         /* ë¸Œë¼ìš°ì € ê¸°ë³¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì œê±° */
        border: 0;                /* í…Œë‘ë¦¬ ì—†ìŒ */
        padding: 8px 12px;        /* ì•ˆìª½ ì—¬ë°± */
        border-radius: 10px;       /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
        background: #2d6cdf;      /* íŒŒë€ìƒ‰ ë°°ê²½ */
        color: #fff;              /* í°ìƒ‰ ê¸€ì */
        font-weight: 700;         /* êµµì€ ê¸€ì */
        cursor: pointer;          /* ë§ˆìš°ìŠ¤ ì†ê°€ë½ ëª¨ì–‘ */
      }
      .btn:active {
        transform: translateY(1px); /* ëˆŒë €ì„ ë•Œ ì‚´ì§ ì•„ë˜ë¡œ -> ë²„íŠ¼ ëˆ„ë¥´ëŠ” ëŠë‚Œ */
      }

      /* ë³´ì¡°(ghost) ë²„íŠ¼: ì˜…ì€ íŒŒë‘ ë°°ê²½ + ì§„í•œ íŒŒë‘ ê¸€ì */
      .ghost {
        background: #e0eefc;
        color: #1b3ea3;
      }

      /* =======================
         í‘œê°€ ë„ˆë¬´ ë„“ì–´ì„œ ë„˜ì¹˜ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš©
         ======================= */
      .table-wrap {
        width: 100%;        /* ê°€ë¡œ ì „ì²´ ì‚¬ìš© */
        overflow-x: auto;   /* ë„˜ì¹˜ë©´ ì•„ë˜ìª½ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ìƒì„± */
      }

      /* ========================
         ë­í‚¹ í‘œ ìŠ¤íƒ€ì¼
         ======================== */

      table {
        width: 100%;          /* ê°€ë¡œ ì „ì²´ ì‚¬ìš© */
        border-collapse: collapse; /* ì…€ ê²½ê³„ì„  ê²¹ì¹˜ì§€ ì•Šê²Œ(ê¹”ë”) */
        font-size: 14px;
      }

      thead th {
        position: sticky; top: 0;  /* í‘œ í—¤ë”ê°€ ìŠ¤í¬ë¡¤í•´ë„ ìœ„ì— ë¶™ì–´ ìˆê²Œ í•¨ */
        background: #f3f6ff;     /* ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½ */
        color: #1b3ea3;          /* ì§„í•œ íŒŒë€ ê¸€ì”¨*/
        font-weight: 800;          /* êµµê²Œ */
        text-align: left;          /* ì™¼ìª½ ì •ë ¬ */
        padding: 12px 10px;        /* ì•ˆìª½ ì—¬ë°± */
        border-bottom: 1px solid #e2e8ff; /* ì•„ë˜ìª½ êµ¬ë¶„ì„  */
        z-index: 1;                /* ìœ„ì— ë–  ìˆë„ë¡ ê°’(í—¤ë” ê²¹ì¹¨ ë°©ì§€) */ 
      }

      tbody td {
        padding: 12px 10px;              /* í‘œ ì…€ ì•ˆìª½ ì—¬ë°± */
        border-bottom: 1px solid #f0f0f0; /* ì¤„ êµ¬ë¶„ì„  */
        white-space: nowrap;                /* ì¤„ë°”ê¿ˆ ì—†ì´ í•œ ì¤„ë¡œ í‘œì‹œ */
      }

      /* í™€ìˆ˜ ì¤„ ë°°ê²½ ì‚´ì§ ë‹¤ë¥´ê²Œ -> ì¤„ êµ¬ë¶„ì´ ì‰½ê²Œ ë³´ì„ */
      tbody tr:nth-child(odd) { background: #fcfcfc; }

      /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ë°°ê²½ ê°•ì¡° -> ì–´ë””ì— ìˆëŠ”ì§€ ì˜ ë³´ì´ê²Œ */
      tbody tr:hover { background: #f2f7ff; }

      /* ìˆœìœ„(ìˆ«ì) ì¹¸ì€ ë” í¬ê³  êµµê²Œ */
      .rank {
        font-weight: 900;  /* ì•„ì£¼ êµµê²Œ */
        font-size: 22px;   /* í¬ê²Œ */
        width: 76px;       /* ì¹¸ ë„ˆë¹„ ê³ ì • -> ìë¦¬ ëœ í”ë“¤ë¦¼ */
        letter-spacing: 0.2px;
      }

      /* 1~3ë“±ì€ ê¸€ììƒ‰ì„ ë§¤ë‹¬ ëŠë‚Œìœ¼ë¡œ */
      .rank.top1 { color: #d07706; } /* ê¸ˆìƒ‰ ëŠë‚Œ */
      .rank.top2 { color: #6b7280; } /* ì€ìƒ‰ ëŠë‚Œ */
      .rank.top3 { color: #b45309; } /* ë™ìƒ‰ ëŠë‚Œ */

      /* 1~10ë“± í–‰ë§ˆë‹¤ ë°°ê²½ìƒ‰ ë‹¤ë¥´ê²Œ -> ìœ„ìª½ ìˆœìœ„ê°€ ëˆˆì— ë„ë„ë¡ */
      tr.row-1 { background: #fff2cc !important; }
      tr.row-2 { background: #fce8e6 !important; }
      tr.row-3 { background: #e7f3ff !important; }
      tr.row-4 { background: #e9f7ef !important; }
      tr.row-5 { background: #f3e8ff !important; }
      tr.row-6 { background: #fff0f6 !important; }
      tr.row-7 { background: #e6fffb !important; }
      tr.row-8 { background: #f0f4ff !important; }
      tr.row-9 { background: #f9fbe7 !important; }
      tr.row-10 { background: #fef7ff !important; }

      /* ë°©ê¸ˆ ì €ì¥í•´ì„œ ë„˜ì–´ì˜¨ ë‚´ ê¸°ë¡(ì˜µì…˜) ê°•ì¡°ìš© ë°°ê²½(ë…¸ë€ìƒ‰) */
      .hl { background: #fff7cc !important; }
      
      /* ì•„ë˜ìª½ ì‘ì€ ì„¤ëª…(í‘¸í„°) ì˜ì—­ */
      .footer {
        max-width: var(--max-w);    /* PCì—ì„œ 600px ì œí•œ */
        margin: 14px auto 0;        /* ìœ„ìª½ ì—¬ë°± + ê°€ìš´ë° ì •ë ¬ */
        color: #666;              /* ì—°í•œ ê¸€ì”¨ìƒ‰ */
        font-size: 12px;            /* ì‘ì€ ê¸€ì”¨ */
        line-height: 1.4;           /* ì¤„ ê°„ê²© */
        padding: 0 2px;             /* ì¢Œìš° ì‚´ì§ ì—¬ë°± */
      }

      /* =======================
         ë°˜ì‘í˜•(PC/ëª¨ë°”ì¼) ì„¤ì •
         - PC : ì½˜í…ì¸  ë„ˆë¹„ 600px ê³ ì •
         - ëª¨ë°”ì¼ : í™”ë©´ ê°€ë¡œ 100% ì‚¬ìš©
         ======================= */
      @media (min-width: 769px) { .wrap { width: var(--max-w); } }
      @media (max-width: 768px) { .wrap { width: 100%; } }

      /* 1_12 : ìƒë‹¨ ì œëª© ìŠ¤íƒ€ì¼ ì¶”ê°€ */
      .game-title {
        text-align: center;      /* ê°€ìš´ë° ì •ë ¬ */
        font-size: 36px;         /* í¼ì§í•œ ê¸€ì */
        font-weight: 900;        /* êµµê²Œ */
        color: #1b3ea3;        /* íŒŒë€ìƒ‰ ê³„ì—´ë¡œ í¬ì¸íŠ¸ */
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3); /* ê·¸ë¦¼ì íš¨ê³¼ */
        margin-top: 16px;        /* ìœ„ìª½ ì—¬ë°± */
        margin-bottom: 8px;      /* ì•„ë˜ ì—¬ë°± */
        letter-spacing: 2px;     /* ê¸€ì ê°„ê²© ì‚´ì§ ë„ìš°ê¸° */
        font-family: 'Trebuche MS', 'Noto Sans KR', sans-serif;
      }
      /* 1_12 : ëª¨ë°”ì¼ì—ì„œëŠ” ê¸€ì í¬ê¸° ì¡°ê¸ˆ ì¤„ì´ê¸° */
      @media (max-width: 768px){
        .game-title{
            font-size: 28px;
        }
      }
    </style>
  </head>

<body>
  <!--
    [í™”ë©´ êµ¬ì„±]
    - .wrap : ì „ì²´ ë‚´ìš©ì„ ê°€ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ
    - .header : ìƒë‹¨ ì œëª©/ì„¤ëª…
    - .card : ì•ˆì— ë²„íŠ¼(íˆ´ë°”) + í‘œ(ë­í‚¹)ê°€ ë“¤ì–´ê°
    -->
    <div class="wrap">
      <!-- ìƒë‹¨: ì œëª©ê³¼ ì„¤ëª…-->
       <div class="header">
       <div>
       <div class="title"> ğŸ† ë­í‚¹ TOP 50</div>
       <div class="sub"> ê¸°ë¡ì´ ì‘ì„ìˆ˜ë¡ ë” ë†’ì€ ìˆœìœ„ì—ìš” (ë‹¨ìœ„:ì´ˆ)</div>
    </div>
  </div>

  <!-- ê°€ìš´ë° ì¹´ë“œ(ë°•ìŠ¤): ë²„íŠ¼ì¤„ + ë­í‚¹ í‘œ -->
   <div class="card">
    <!-- íˆ´ë°”: ìƒˆë¡œê³ ì¹¨ / ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°-->
     <div class="toolbar">
    <button class="btn ghost" id="btnRefresh">ìƒˆë¡œê³ ì¹¨</button>
    <button class="btn" id="btnBack">ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
   </div>

   <!-- í‘œë¥¼ ê°€ë¡œë¡œ ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ë˜ë„ë¡ ê°ì‹¸ëŠ” ë°•ìŠ¤ -->
   <div class="table-wrap">
    <table aria-label="ë­í‚¹ í‘œ">
      <thead>
        <tr>
          <!-- thead(th) : í‘œì˜ ì œëª© í–‰-->
           <th class="rank">ìˆœìœ„</th>
           <th>ì•„ì´ë””</th>
           <th>ê¸°ë¡(ì´ˆ)</th>
           <th>ì €ì¥ì‹œê°</th>
        </tr>
      </thead>
      <tbody id="rankBody">
        <!-- ì²˜ìŒì—” "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."ì„ ë³´ì—¬ì£¼ê³ ,
         ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ Firestoreì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë©´ ì‹¤ì œ ë‚´ìš©ìœ¼ë¡œ ë°”ê¿”ì¹˜ê¸° -->
         <tr><td colspan="4">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
      </tbody>
    </table>
   </div>
   </div>

   <!-- í•˜ë‹¨ ì„¤ëª… -->
    <div class="footer">
      * ë™ì ì¼ ê²½ìš° ì €ì¥ ìˆœì„œë¡œ ì •ë ¬ë  ìˆ˜ ìˆì–´ìš”.<br/>
      * ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” Firestore ë³´ì•ˆ ê·œì¹™ì„ ê¼­ ì ìš©í•´ì•¼ í•´ìš”.
    </div>
</body>

<!--
  [Firebase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°]
  - compat(í˜¸í™˜) ë²„ì „ì€ import ê°™ì€ ê³ ê¸‰ ë¬¸ë²• ì—†ì´
  <script>ë§Œìœ¼ë¡œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ í•™ìŠµìš©ìœ¼ë¡œ ì¢‹ë‹¤.
  - ì „ì—­ì— firebase ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ê°ì²´ê°€ ìƒê¹€.
  -->
  <script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore-compat.js"></script>

  <!--
   [ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¡œì§]
   - Firebase ì—°ê²° -> Firestore ì¤€ë¹„
   - ì£¼ì†Œì°½ì—ì„œ lastId/lastTime ë°›ê¸°(ì˜µì…˜)
   - ë„ìš°ë¯¸ í•¨ìˆ˜ ì •ì˜(to2, fmtDate, escapeHtml)
   - loadRanking(): Firestoreì—ì„œ ë­í‚¹ 50ê°œ ë¶ˆëŸ¬ì™€ í‘œì— ê·¸ë¦¬ê¸°
   - ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°(ìƒˆë¡œê³ ì¹¨, ëŒì•„ê°€ê¸°)
   -í˜ì´ì§€ ì²˜ìŒ ì—´ë¦´ ë•Œ 1ë²ˆ ì‹¤í–‰
   -->
  <script>
    /* 1) Firebase í”„ë¡œì íŠ¸ ì—°ê²° ì •ë³´
    - ê²Œì„ ì €ì¥ í˜ì´ì§€ì—ì„œ ì“´ ê°’ê³¼ "ê°™ì€ ê°’"ì„ ì¨ì•¼ ê°™ì€ DBë¥¼ ì½ê³  ì”€
    - Firebase ì½˜ì†” -> (í”„ë¡œì íŠ¸ ì„ íƒ) -> ì•± ì„¤ì •ì—ì„œ í™•ì¸ ê°€ëŠ¥
    */
   var firebaseConfig = {
    apiKey: "AIzaSyAHpiAjF8_X2OgmIRXXWxq5qinoVa07S8M",
    authDomain: "my-webgame-project1-2b57b.firebaseapp.com",
    projectId: "my-webgame-project1-2b57b",
    storageBucket: "my-webgame-project1-2b57b.firebasestorage.app",
    messagingSenderId: "123464054285",
    appId: "1:123464054285:web:c3a3ac957cde3169a8c744"
  };

  /* 2) Firebase ì‹œì‘(ì´ˆê¸°í™”) + Firestore ì‚¬ìš© ì¤€ë¹„ */
  firebase.initializeApp(firebaseConfig);
  var db = firebase.firestore();

  /* 3) ì£¼ì†Œì°½ì—ì„œ ?lastId=...&lastTime=... ê°’ì„ êº¼ë‚´ê¸°(ì˜µì…˜)
     - ê²Œì„ì—ì„œ "ì €ì¥ ì„±ê³µ í›„" ì´ í˜ì´ì§€ë¡œ ë„˜ì–´ì˜¬ ë•Œ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ì „ë‹¬í•˜ë©´
     ë§‰ ì €ì¥í•œ ë‚´ ê¸°ë¡ì„ í‘œì—ì„œ ë…¸ë€ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸ í•  ìˆ˜ ìˆìŒ
     */ 
    function getQueryParam(name) {
      var query = location.search.replace(/^\?/, ''); // ë§¨ ì•ì˜ ? ì œê±°
      var parts = query.split('&');  // 'a=1&b=2' -> ['a=1', 'b=2']
      for (var i = 0; i < parts.length; i++) {
        var kv = parts[i].split('=');  // 'a=1' -> ['a', '1']
        if (decodeURIComponent(kv[0]) === name) {
          return kv[1] ? decodeURIComponent(kv[1]) : '';
        }
      }
      return null; // ëª» ì°¾ìœ¼ë©´ null ë°˜í™˜
    }
    var lastId = getQueryParam('lastId');  // ë°©ê¸ˆ ì €ì¥í•œ ì•„ì´ë””(ë¬¸ìì—´)
    var lastTime = getQueryParam('lastTime'); // ë°©ê¸ˆ ì €ì¥í•œ ê¸°ë¡(ì´ˆ, ë¬¸ìì—´)

    /* 4) ë„ìš°ë¯¸ í•¨ìˆ˜ë“¤ */ 
    
    // (a) ìˆ«ìë¥¼ ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ "ë¬¸ìì—´"ë¡œ ë§Œë“¤ê¸° (ì˜ˆ: 1 -> "1.00", 1,234 -> "1.23")
    function to2(n) {
      if (typeof n !== 'number' || !isFinite(n)) return '';
      return (Math.round(n * 100) / 100).toFixed(2);
    }

    // (b) Firestore Timestampë¥¼ ë³´ê¸° ì¢‹ì€ ë‚ ì§œ ê¸€ìë¡œ ë°”ê¾¸ê¸°
    function fmtDate(ts) {
      if (!ts || !ts.toDate) return '';
      var d = ts.toDate(); // Timestmap -> Date

      var y = d.getFullYear();
      var m = d.getMonth() + 1; // 0~11ì´ë¼ +1
      var day = d.getDate(); 
      var hh = d.getHours();
      var mm = d.getMinutes();

      // í•­ìƒ ë‘ ìë¦¬ë¡œ(2 -> 02)
      if(m<10) m = '0' + m;
      if (day < 10) day = '0' + day;
      if (hh < 10) hh = '0' + hh;
      if (mm < 10) mm = '0' + mm;

      return y + '-' + m + '-' + day + ' ' + hh + ':' + mm;
    }
    
    // (c) ì•„ì´ë”” ë¬¸ìì—´ì„ HTMLì—ì„œ ì•ˆì „í•˜ê²Œ í‘œì‹œ(íƒœê·¸ë¡œ ì˜¤í•´í•˜ì§€ ì•Šë„ë¡)
    function escapeHtml(s) {
      s = String(s);
      s = s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      s = s.replace(/"/g,'&quot;').replace(/'/g, '&#39;');
      return s;
    }

    /* 5) ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸°
       - Firestoreì˜ scores ì»¬ë ‰ì…˜ì—ì„œ
       time(ê¸°ë¡, ì´ˆ) ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•˜ì—¬ 50ê°œë§Œ ê°€ì ¸ì˜´
       - ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ í‘œ(<tbody>) ì•ˆì„ ë§Œë“¤ì–´ ë„£ì–´ì¤Œ
        */ 
       function loadRanking() {
        var body = document.getElementById('rankBody');

        // í‘œë¥¼ ë¹„ìš°ê³  "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..." ì„ì‹œ ë¬¸êµ¬ ë³´ì—¬ì£¼ê¸°
        body.innerHTML = '<tr><td colspan="4">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';

        // Firestoreì— ìš”ì²­ ë³´ë‚´ê¸°
        db.collection('scores')
          .orderBy('time', 'asc') // ê¸°ë¡(ì´ˆ)ì´ ì‘ì€ ìˆœì„œëŒ€ë¡œ(ë¹ ë¥¸ ìˆœì„œ)
          .limit(50)              // ìµœëŒ€ 50ê°œ
          .get()                  // ì„œë²„ì— ë°ì´í„° ìš”ì²­(ë¹„ë™ê¸°)
          .then(function(snapshot){
            //ì„±ê³µí•˜ë©´ ì—¬ê¸° ì‹¤í–‰
            var html = ''; // í‘œì˜ ì¤„ë“¤ì„ ë¬¸ìì—´ë¡œ ìŒ“ëŠ” ë³€ìˆ˜
            var rank = 0;  // ìˆœìœ„(1ë“±, 2ë“±, 3ë“± ...) ì¹´ìš´í„°

            //ê°€ì ¸ì˜¨ ë¬¸ì„œë“¤ì„ í•˜ë‚˜ì”© êº¼ë‚´ê¸°
            snapshot.forEach(function(doc) {
              var date = doc.data() || {};
              var userId = date.userId || ''; // ì•„ì´ë””
              var time = Number(date.time);   // ê¸°ë¡(ì´ˆ)
              var createdAt = date.createdAt || null; // ì €ì¥ ì‹œê°(Firebase Timestamp)

              rank = rank + 1;            // ìˆœìœ„ ì¦ê°€

              // ìƒìœ„ 3ê°œëŠ” ë©”ë‹¬ ì´ëª¨ì§€ ë³´ì—¬ì£¼ê¸°
              var medal = '';
              if (rank === 1) { medal = 'ğŸ¥‡'; } 
              else if (rank === 2) { medal = 'ğŸ¥ˆ' ; }
              else if (rank === 3) { medal = 'ğŸ¥‰' ; }

              // 1~10ë“±ì€ ê°ì ë‹¤ë¥¸ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ ë¶™ì´ê¸°
              var rowClass = '';
              if (rank <= 10) { rowClass = 'row-' + rank; }

              // ë°©ê¸ˆ ì €ì¥í•œ ë‚´ ê¸°ë¡ì„ ê°•ì¡°(ë…¸ë€ìƒ‰)í•˜ê¸° -> ì£¼ì†Œì°½ ê°’ê³¼ ë¹„êµ
              var isHL = false;
              if (lastId !== null && lastTime !== null) {
                if (String(userId) === String(lastId) &&
                  to2(Number(time)) === to2(Number(lastTime))) {
                isHL = true;
                  }
              }
              

              // 1~3ë“±ì€ ìˆœìœ„ ìˆ«ì ìƒ‰ë„ ë‹¤ë¥´ê²Œ
              var rankClass = '';
              if (rank === 1) rankClass = 'top1';
              else if (rank === 2) rankClass = 'top2';
              else if (rank === 3) rankClass = 'top3';
              // í‘œ í•œ ì¤„ ë§Œë“¤ê¸° (+ì—°ì‚°ë§Œ ì‚¬ìš© -> ê¸°ì´ˆ ë¬¸ë²•ì— ì¹œìˆ™í•´ì§€ê¸°)
              html += '<tr class="' + (isHL ? 'hl ' : '' ) + rowClass + '">';
              html +=   '<td class="rank ' + rankClass + '">' + medal + rank + '</td>';
              html +=   '<td>' + escapeHtml(userId) + '</td>';
              html +=   '<td>' + to2(time) + '</td>';
              html +=   '<td>' + fmtDate(createdAt) + '</td>';
              html += '</tr>';
            });

            // ë°ì´í„°ê°€ ì•„ì˜ˆ ì—†ìœ¼ë©´ ì•ˆë‚´ ë¬¸êµ¬, ìˆìœ¼ë©´ ë§Œë“  ì¤„ë“¤ë¡œ êµì²´
            if (html === '') {
              body.innerHTML = '<tr><td colspan="4">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            } else {
              body.innerHTML = html;
            }
          })
          .catch(function(err) {
            // ì‹¤íŒ¨(ì—ëŸ¬) ì‹œ: ì½˜ì†”ì— ê¸°ë¡í•˜ê³ , í™”ë©´ì—ë„ ì•ˆë‚´
            console.error(err);
            body.innerHTML = '<tr><td colspan="4" style="color:#c00;">ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê·œì¹™/ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.</td></tr>';
          });
       }

       /* 6) ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
          - ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼: ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
          - ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°: ê²Œì„ í˜ì´ì§€ë¡œ ì´ë™(íŒŒì¼ëª…ì€ í”„ë¡œì íŠ¸ì— ë§ê²Œ)
          */ 
         document.getElementById('btnRefresh').onclick = function() {
          loadRanking();
         };
         /* 1_12 : ë²„íŠ¼ì„ íƒì‹œ ë©”ì¸ ì´ë™í˜ì´ì§€ ì´ë¦„ canvas_js_exam_1_12ë¡œ ìˆ˜ì • */
         document.getElementById('btnBack').onclick = function() {
          // ê²Œì„ íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš” (ì˜ˆ: canvas_js_exam_1_11.html)
          location.href = "canvas_js_exam_1_12_exam.html";
         };

         /* 7) í˜ì´ì§€ê°€ ì²˜ìŒ ì—´ë¦´ ë–„, ë­í‚¹ 1ë²ˆ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° */ 
         loadRanking();
  </script>
  </body>
  </html>
